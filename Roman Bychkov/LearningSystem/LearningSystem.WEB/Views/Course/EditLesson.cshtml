@using Microsoft.MarkedNet
@model Course

@{
ViewData["Title"] = Model?.CourseName + " - " + Model?.Articles.SingleOrDefault(a => a?.Number == ViewBag.Number)?.ArticleName;
}
  <script>
        document.getElementById('container').classList.remove('container');
   </script>

<div class="course-title">
  <a href="/Course/@Model?.Id/EditLesson"><h3><b>КУРС - @Model?.CourseName</b></h3></a>
</div>
<div class="lessons-content-container">
    <div>
        <div class="lessons-container">
            @foreach (Article item in Model?.Articles?.OrderBy(a => a?.Number))
            {

                <a asp-area="" asp-controller="Course" asp-action="EditLesson" asp-route-id="@Model.Id" asp-route-number="@item?.Number">
                    <div  class="display-flex">
                       <p id="@item?.Number" class="number-lesson">@item?.Number</p>  <p>@item?.ArticleName</p>
                    </div>
                </a>
            }
        
        </div>
        <div>
           <form id="FormLesson" action="/Course/AddLesson" method="post">
                  <div>
                        <input type="hidden" name="Id" value="@Model.Id" />
                  </div>
                 <button type="submit" class="display-flex"> 
                           <img class="icon" flex-basis: 0" src="~/icon/plus.png" />
                            Додати урок
                  </button>
            </form>
        </div>
    </div>
    <div class="course-content">
        
        @if (ViewBag?.Number == null)
        {
            var marked = new Marked();
            var htmlString = marked.Parse(@Model?.Content);
            @Html.Raw(htmlString);
        }
        else
        {   <form method="post" asp-controller="Course" asp-action="DeleteLesson" asp-route-id="@Model.Id" asp-route-number="@ViewBag?.Number">
                           
                            <button type="submit" class="course-delete">
                                ВИДАЛИТИ
                                <img class="icon icon-transparent" style="background-color: transparent" flex-basis: 0" src="~/icon/basket.png" />
                            </button>
            </form>
            <div id="editor" >
             <form id="FormLesson" action="/Course/EditLesson" method="post">
                  <div>
                        <label name="Name" class="form-label">Назва уроку</label>
                        <input type="text" required name="Name" value="@Model?.Articles.SingleOrDefault(a => a?.Number == ViewBag.Number)?.ArticleName" class="form-control">
                  </div>
                 <div>
                     <textarea required  name="Content">@Model?.Articles.SingleOrDefault(a => a?.Number == ViewBag.Number)?.Content </textarea>
                     <button type="submit">Обновити</button>
                 </div>
                    <div>
                        <input type="hidden" name="CourseId" value="@Model.Id" />
                    </div>
                    <div>
                        <input type="hidden" name="Number" value="@ViewBag?.Number">
                    </div>
             </form>
             </div>
            
        }  
          </div>
    <script>
       document.getElementById('@ViewBag.Number').classList.add('active-lesson');
    </script>
    <script>
           var simplemde = new SimpleMDE({autosave: {
		    enabled: false,
		    uniqueId: "MyUniqueID",
		    delay: 1000,
	    },
	    renderingConfig: {
		    singleLineBreaks: false,
		    codeSyntaxHighlighting: true,
	    },
	    showIcons: ["code", "table"],});
    </script>
    
    <script src="~/js/lessonCreate.js" asp-append-version="true"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.17.0/jquery.validate.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validation.unobtrusive/3.2.10/jquery.validate.unobtrusive.min.js"></script>
 </div>




